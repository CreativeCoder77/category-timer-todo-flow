
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TaskFlow</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lucide-icons@0.171.0/font/lucide.min.css">
  <style>
    /* Reset and Base Styles */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --background: #fafafa;
      --foreground: #09090b;
      --card: #ffffff;
      --card-foreground: #09090b;
      --popover: #ffffff;
      --popover-foreground: #09090b;
      --primary: #6941c6;
      --primary-foreground: #ffffff;
      --secondary: #f4f5f6;
      --secondary-foreground: #09090b;
      --muted: #f1f5f9;
      --muted-foreground: #6c757d;
      --accent: #f4f5f6;
      --accent-foreground: #09090b;
      --destructive: #ef4444;
      --destructive-foreground: #fafafa;
      --border: #e2e8f0;
      --input: #e2e8f0;
      --ring: #6941c6;
      --radius: 0.5rem;
      --sidebar-width: 250px;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.5;
      color: var(--foreground);
      background-color: var(--background);
    }
    
    /* Layout */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }
    
    .app {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    
    /* Sidebar */
    .sidebar {
      width: var(--sidebar-width);
      background-color: var(--card);
      border-right: 1px solid var(--border);
      padding: 1rem;
      overflow-y: auto;
      height: 100%;
      transition: transform 0.3s ease;
      flex-shrink: 0;
    }
    
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        z-index: 50;
        transform: translateX(-100%);
      }
      
      .sidebar.open {
        transform: translateX(0);
      }
      
      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 40;
      }
      
      .sidebar-overlay.open {
        display: block;
      }
    }
    
    /* Main Content */
    .main {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      height: 100%;
    }
    
    /* Typography */
    h1 {
      font-size: 1.875rem;
      font-weight: 700;
      margin-bottom: 1rem;
    }
    
    h2 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }
    
    h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    /* Components */
    .button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius);
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s, color 0.2s, border-color 0.2s;
      border: 1px solid transparent;
    }
    
    .button-primary {
      background-color: var(--primary);
      color: var(--primary-foreground);
    }
    
    .button-primary:hover {
      background-color: hsl(259, 60%, 44%);
    }
    
    .button-secondary {
      background-color: var(--secondary);
      color: var(--secondary-foreground);
    }
    
    .button-secondary:hover {
      background-color: hsl(210, 3%, 90%);
    }
    
    .button-outline {
      background-color: transparent;
      border-color: var(--border);
    }
    
    .button-outline:hover {
      background-color: var(--muted);
    }
    
    .button-destructive {
      background-color: var(--destructive);
      color: var(--destructive-foreground);
    }
    
    .button-destructive:hover {
      background-color: hsl(0, 84%, 54%);
    }
    
    .button-ghost {
      background-color: transparent;
    }
    
    .button-ghost:hover {
      background-color: var(--muted);
    }
    
    .button-sm {
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
    }
    
    .button-icon {
      padding: 0.5rem;
    }
    
    .button-icon-sm {
      padding: 0.25rem;
      height: 2rem;
      width: 2rem;
    }
    
    .button[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* Forms */
    .input {
      width: 100%;
      padding: 0.5rem;
      border-radius: var(--radius);
      border: 1px solid var(--input);
      background-color: var(--background);
      color: var(--foreground);
      font-size: 0.875rem;
      transition: border-color 0.2s;
    }
    
    .input:focus {
      outline: none;
      border-color: var(--ring);
      box-shadow: 0 0 0 2px rgba(105, 65, 198, 0.1);
    }
    
    .label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    /* Task List */
    .task-card {
      display: flex;
      align-items: center;
      padding: 0.75rem;
      border-radius: var(--radius);
      background-color: var(--card);
      border: 1px solid var(--border);
      margin-bottom: 0.5rem;
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
      user-select: none;
    }
    
    .task-card.dragging {
      opacity: 0.5;
      background-color: var(--secondary);
    }
    
    .task-card:hover {
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .drag-handle {
      cursor: grab;
      margin-right: 0.5rem;
      color: var(--muted-foreground);
    }
    
    .task-title {
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
    }
    
    .task-completed .task-title {
      text-decoration: line-through;
      color: var(--muted-foreground);
    }
    
    .task-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
    }
    
    .category-pill {
      font-size: 0.75rem;
      padding: 0.125rem 0.375rem;
      border-radius: 1rem;
      white-space: nowrap;
    }
    
    .class-badge {
      font-size: 0.75rem;
      padding: 0.125rem 0.375rem;
      border-radius: 1rem;
      white-space: nowrap;
    }
    
    .task-actions {
      margin-left: auto;
      display: flex;
      opacity: 0;
      transition: opacity 0.2s;
    }
    
    .task-card:hover .task-actions {
      opacity: 1;
    }

    .priority-high {
      border-left: 3px solid #ef4444;
    }
    
    .priority-medium {
      border-left: 3px solid #f59e0b;
    }
    
    .priority-low {
      border-left: 3px solid #3b82f6;
    }
    
    .due-soon {
      color: #f59e0b;
    }
    
    .overdue {
      color: #ef4444;
    }
    
    /* Filter Bar */
    .filter-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
      align-items: center;
    }
    
    .search-input {
      position: relative;
      flex: 1;
    }
    
    .search-input .input {
      padding-left: 2rem;
    }
    
    .search-icon {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted-foreground);
      pointer-events: none;
    }
    
    /* Dropdown */
    .dropdown {
      position: relative;
    }
    
    .dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      z-index: 10;
      min-width: 10rem;
      padding: 0.5rem;
      background-color: var(--popover);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-top: 0.25rem;
      display: none;
    }
    
    .dropdown-menu.open {
      display: block;
      animation: fadeIn 0.2s ease-out;
    }
    
    .dropdown-item {
      padding: 0.375rem 0.5rem;
      cursor: pointer;
      border-radius: calc(var(--radius) - 0.25rem);
      font-size: 0.875rem;
    }
    
    .dropdown-item:hover {
      background-color: var(--muted);
    }

    /* Modal/Dialog */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease-in-out;
    }
    
    .modal-overlay.open {
      opacity: 1;
      visibility: visible;
    }
    
    .modal {
      background-color: var(--card);
      border-radius: var(--radius);
      padding: 1.5rem;
      width: 100%;
      max-width: 32rem;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      transform: translateY(-10px);
      opacity: 0;
      transition: transform 0.2s ease, opacity 0.2s ease;
    }
    
    .modal-overlay.open .modal {
      transform: translateY(0);
      opacity: 1;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .modal-title {
      font-size: 1.25rem;
      font-weight: 600;
    }
    
    .modal-close {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--muted-foreground);
    }
    
    .modal-close:hover {
      color: var(--foreground);
    }
    
    .modal-body {
      margin-bottom: 1rem;
    }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }
    
    /* Category List */
    .category-list {
      list-style: none;
      margin-bottom: 1.5rem;
    }
    
    .category-item {
      display: flex;
      align-items: center;
      padding: 0.5rem;
      border-radius: var(--radius);
      cursor: pointer;
      margin-bottom: 0.25rem;
    }
    
    .category-item:hover,
    .category-item.active {
      background-color: var(--muted);
    }
    
    .category-color {
      width: 0.75rem;
      height: 0.75rem;
      border-radius: 50%;
      margin-right: 0.5rem;
    }
    
    .category-name {
      font-size: 0.875rem;
      flex: 1;
    }
    
    .category-count {
      font-size: 0.75rem;
      color: var(--muted-foreground);
      background-color: var(--muted);
      border-radius: 1rem;
      padding: 0 0.5rem;
    }
    
    /* Focus Timer */
    .focus-timer {
      padding: 1rem;
      border-radius: var(--radius);
      background-color: var(--muted);
      margin-bottom: 1rem;
    }
    
    .timer-display {
      font-size: 2rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 1rem;
    }
    
    .timer-buttons {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-5px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }

    /* Date Picker */
    .datepicker {
      position: relative;
    }

    .calendar {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      z-index: 10;
      width: 250px;
      padding: 1rem;
      background-color: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .calendar.open {
      display: block;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
    }

    .calendar-day-header {
      text-align: center;
      font-size: 0.75rem;
      font-weight: 600;
      padding: 0.25rem;
      color: var(--muted-foreground);
    }

    .calendar-day {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 30px;
      width: 100%;
      font-size: 0.875rem;
      cursor: pointer;
      border-radius: calc(var(--radius) - 0.25rem);
    }

    .calendar-day.current-month:hover {
      background-color: var(--muted);
    }

    .calendar-day.selected {
      background-color: var(--primary);
      color: var(--primary-foreground);
    }

    .calendar-day.other-month {
      color: var(--muted-foreground);
      opacity: 0.5;
    }

    .calendar-day.today {
      font-weight: 700;
      border: 1px solid var(--primary);
    }

    /* Toast Notification */
    .toast-container {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      display: flex;
      flex-direction: column-reverse;
      gap: 0.5rem;
      z-index: 100;
    }

    .toast {
      padding: 0.75rem 1rem;
      background-color: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      width: 18rem;
      max-width: 90vw;
      animation: slideInRight 0.3s ease-out;
    }

    .toast-content {
      flex: 1;
    }

    .toast-title {
      font-weight: 500;
      font-size: 0.875rem;
      margin-bottom: 0.25rem;
    }

    .toast-description {
      font-size: 0.75rem;
      color: var(--muted-foreground);
    }

    .toast-close {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--muted-foreground);
      padding: 0;
      height: 16px;
      width: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Task Detail Modal */
    .task-detail {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .task-detail-header {
      border-bottom: 1px solid var(--border);
      padding-bottom: 0.5rem;
    }

    .task-detail-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .task-detail-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .task-detail-section {
      margin-bottom: 1rem;
    }

    .task-detail-section-title {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--muted-foreground);
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="sidebar-overlay"></div>
    <div class="sidebar">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h3>TaskFlow</h3>
        <button class="sidebar-close button button-ghost button-icon button-sm" aria-label="Close sidebar">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
        </button>
      </div>

      <div class="focus-timer">
        <div class="timer-display">25:00</div>
        <div class="timer-buttons">
          <button class="button button-primary" id="start-timer">Start</button>
          <button class="button button-outline" id="reset-timer" disabled>Reset</button>
        </div>
      </div>

      <h3>Categories</h3>
      <ul class="category-list" id="category-list">
        <li class="category-item active" data-id="all">
          <span class="category-name">All Tasks</span>
          <span class="category-count">0</span>
        </li>
      </ul>

      <div class="form-group">
        <button class="button button-outline" id="add-category-btn" style="width: 100%;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.25rem;"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
          Add Category
        </button>
      </div>

      <h3>Classes</h3>
      <ul class="category-list" id="class-list"></ul>

      <div class="form-group">
        <button class="button button-outline" id="add-class-btn" style="width: 100%;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.25rem;"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
          Add Class
        </button>
      </div>
    </div>

    <div class="main">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <button class="button button-ghost button-icon sidebar-toggle" aria-label="Toggle sidebar" style="display: none;">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" x2="21" y1="6" y2="6"></line><line x1="3" x2="21" y1="12" y2="12"></line><line x1="3" x2="21" y1="18" y2="18"></line></svg>
        </button>
        <h1>Tasks</h1>
        <button class="button button-primary" id="add-task-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.25rem;"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
          New Task
        </button>
      </div>

      <div class="filter-bar">
        <div class="search-input">
          <span class="search-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
          </span>
          <input type="text" class="input" id="search-input" placeholder="Search tasks...">
        </div>

        <div class="filter-buttons">
          <button class="button button-sm button-primary" data-filter="all">All</button>
          <button class="button button-sm button-outline" data-filter="active">Active</button>
          <button class="button button-sm button-outline" data-filter="completed">Completed</button>
        </div>

        <div class="dropdown">
          <button class="button button-sm button-outline dropdown-trigger" id="sort-dropdown-trigger">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.25rem;"><path d="m3 16 4 4 4-4"></path><path d="M7 20V4"></path><path d="m21 8-4-4-4 4"></path><path d="M17 4v16"></path></svg>
            Sort
          </button>
          <div class="dropdown-menu" id="sort-dropdown">
            <div class="dropdown-item" data-sort="order">Manual Order</div>
            <div class="dropdown-item" data-sort="title">Title</div>
            <div class="dropdown-item" data-sort="dueDate">Due Date</div>
            <div class="dropdown-item" data-sort="priority">Priority</div>
          </div>
        </div>

        <div class="dropdown">
          <button class="button button-sm button-outline dropdown-trigger" id="priority-dropdown-trigger">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.25rem;"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path><line x1="4" x2="4" y1="22" y2="15"></line></svg>
            Priority
          </button>
          <div class="dropdown-menu" id="priority-dropdown">
            <div class="dropdown-item" data-priority="all">All</div>
            <div class="dropdown-item" data-priority="high">High</div>
            <div class="dropdown-item" data-priority="medium">Medium</div>
            <div class="dropdown-item" data-priority="low">Low</div>
          </div>
        </div>
      </div>

      <div id="task-list"></div>
    </div>
  </div>

  <!-- Task Modal -->
  <div class="modal-overlay" id="task-modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">New Task</h3>
        <button class="modal-close" aria-label="Close modal">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="task-form">
          <div class="form-group">
            <label class="label" for="task-title">Title</label>
            <input type="text" class="input" id="task-title" required>
          </div>

          <div class="form-group">
            <label class="label" for="task-category">Category</label>
            <select class="input" id="task-category">
              <option value="default">Uncategorized</option>
            </select>
          </div>

          <div class="form-group">
            <label class="label">Classes</label>
            <div id="task-classes"></div>
          </div>

          <div class="form-group">
            <label class="label" for="task-due-date">Due Date</label>
            <div class="datepicker">
              <input type="text" class="input" id="task-due-date" placeholder="Select a date" readonly>
              <div class="calendar" id="task-calendar"></div>
            </div>
          </div>

          <div class="form-group">
            <label class="label" for="task-priority">Priority</label>
            <select class="input" id="task-priority">
              <option value="">None</option>
              <option value="high">High</option>
              <option value="medium">Medium</option>
              <option value="low">Low</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="button button-outline" id="cancel-task-btn">Cancel</button>
        <button class="button button-primary" id="save-task-btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Category Modal -->
  <div class="modal-overlay" id="category-modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">New Category</h3>
        <button class="modal-close" aria-label="Close modal">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="category-form">
          <div class="form-group">
            <label class="label" for="category-name">Name</label>
            <input type="text" class="input" id="category-name" required>
          </div>

          <div class="form-group">
            <label class="label" for="category-color">Color</label>
            <input type="color" class="input" id="category-color" value="#6941c6">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="button button-outline" id="cancel-category-btn">Cancel</button>
        <button class="button button-primary" id="save-category-btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Class Modal -->
  <div class="modal-overlay" id="class-modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">New Class</h3>
        <button class="modal-close" aria-label="Close modal">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="class-form">
          <div class="form-group">
            <label class="label" for="class-name">Name</label>
            <input type="text" class="input" id="class-name" required>
          </div>

          <div class="form-group">
            <label class="label" for="class-color">Color</label>
            <input type="color" class="input" id="class-color" value="#f97316">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="button button-outline" id="cancel-class-btn">Cancel</button>
        <button class="button button-primary" id="save-class-btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Task Detail Modal -->
  <div class="modal-overlay" id="task-detail-modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="task-detail-title"></h3>
        <button class="modal-close" aria-label="Close modal">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="task-detail" id="task-detail"></div>
      </div>
      <div class="modal-footer">
        <button class="button button-outline" id="close-task-detail-btn">Close</button>
        <button class="button button-primary" id="edit-task-btn">Edit</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container"></div>

  <script>
    // Task, Category, and Class data structures
    let tasks = [];
    let categories = [];
    let customClasses = [];
    
    // State
    let activeCategory = null;
    let activeTask = null;
    let filterCompleted = null;
    let searchTerm = "";
    let sortField = "order";
    let sortDirection = "asc";
    let filterPriority = null;

    // Timer state
    let timerInterval;
    let timerMinutes = 25;
    let timerSeconds = 0;
    let timerRunning = false;
    
    // Element references
    const taskListEl = document.getElementById("task-list");
    const categoryListEl = document.getElementById("category-list");
    const classListEl = document.getElementById("class-list");
    const searchInputEl = document.getElementById("search-input");
    const sortDropdownTriggerEl = document.getElementById("sort-dropdown-trigger");
    const sortDropdownEl = document.getElementById("sort-dropdown");
    const priorityDropdownTriggerEl = document.getElementById("priority-dropdown-trigger");
    const priorityDropdownEl = document.getElementById("priority-dropdown");
    const filterButtonsEl = document.querySelector(".filter-buttons");
    
    // Modal elements
    const taskModalOverlayEl = document.getElementById("task-modal-overlay");
    const categoryModalOverlayEl = document.getElementById("category-modal-overlay");
    const classModalOverlayEl = document.getElementById("class-modal-overlay");
    const taskDetailModalOverlayEl = document.getElementById("task-detail-modal-overlay");
    
    // Forms
    const taskFormEl = document.getElementById("task-form");
    const categoryFormEl = document.getElementById("category-form");
    const classFormEl = document.getElementById("class-form");
    
    // Timer elements
    const timerDisplayEl = document.querySelector(".timer-display");
    const startTimerBtnEl = document.getElementById("start-timer");
    const resetTimerBtnEl = document.getElementById("reset-timer");
    
    // Buttons
    const addTaskBtnEl = document.getElementById("add-task-btn");
    const saveTaskBtnEl = document.getElementById("save-task-btn");
    const cancelTaskBtnEl = document.getElementById("cancel-task-btn");
    const addCategoryBtnEl = document.getElementById("add-category-btn");
    const saveCategoryBtnEl = document.getElementById("save-category-btn");
    const cancelCategoryBtnEl = document.getElementById("cancel-category-btn");
    const addClassBtnEl = document.getElementById("add-class-btn");
    const saveClassBtnEl = document.getElementById("save-class-btn");
    const cancelClassBtnEl = document.getElementById("cancel-class-btn");
    const closeTaskDetailBtnEl = document.getElementById("close-task-detail-btn");
    const editTaskBtnEl = document.getElementById("edit-task-btn");
    
    // Modal close buttons
    const modalCloseBtns = document.querySelectorAll(".modal-close");
    
    // Sidebar elements
    const sidebarEl = document.querySelector(".sidebar");
    const sidebarToggleEl = document.querySelector(".sidebar-toggle");
    const sidebarCloseEl = document.querySelector(".sidebar-close");
    const sidebarOverlayEl = document.querySelector(".sidebar-overlay");

    // Date picker
    const dueDateInputEl = document.getElementById("task-due-date");
    const calendarEl = document.getElementById("task-calendar");
    
    // Utility functions
    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = Math.random() * 16 | 0;
        const v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }
    
    function formatDate(date) {
      if (!date) return "";
      const d = new Date(date);
      return `${d.getMonth() + 1}/${d.getDate()}/${d.getFullYear()}`;
    }
    
    function showToast(title, description = "", duration = 3000) {
      const toastContainer = document.getElementById("toast-container");
      const toast = document.createElement("div");
      toast.className = "toast";
      
      toast.innerHTML = `
        <div class="toast-content">
          <div class="toast-title">${title}</div>
          ${description ? `<div class="toast-description">${description}</div>` : ""}
        </div>
        <button class="toast-close" aria-label="Close toast">
          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
        </button>
      `;
      
      toastContainer.appendChild(toast);
      
      const closeBtn = toast.querySelector(".toast-close");
      closeBtn.addEventListener("click", () => {
        toast.remove();
      });
      
      setTimeout(() => {
        toast.remove();
      }, duration);
    }
    
    function openModal(modalEl) {
      modalEl.classList.add("open");
    }
    
    function closeModal(modalEl) {
      modalEl.classList.remove("open");
    }
    
    function closeAllModals() {
      document.querySelectorAll(".modal-overlay").forEach(modal => {
        closeModal(modal);
      });
    }

    function closeAllDropdowns() {
      document.querySelectorAll(".dropdown-menu").forEach(dropdown => {
        dropdown.classList.remove("open");
      });
    }

    // Load data from localStorage
    function loadData() {
      // Load categories
      const savedCategories = localStorage.getItem("categories");
      categories = savedCategories ? JSON.parse(savedCategories) : [
        { id: "default", name: "Uncategorized", color: "#9b87f5" },
        { id: "work", name: "Work", color: "#9b87f5" },
        { id: "personal", name: "Personal", color: "#6E59A5" },
      ];
      
      // Load classes
      const savedClasses = localStorage.getItem("customClasses");
      customClasses = savedClasses ? JSON.parse(savedClasses) : [
        { id: "important", name: "Important", color: "#f97316" },
        { id: "urgent", name: "Urgent", color: "#ea384c" },
      ];
      
      // Load tasks
      const savedTasks = localStorage.getItem("tasks");
      tasks = savedTasks ? JSON.parse(savedTasks) : [];
      
      // Render everything
      renderCategories();
      renderClasses();
      renderTasks();
      updateTaskCount();
    }
    
    // Save data to localStorage
    function saveData() {
      localStorage.setItem("categories", JSON.stringify(categories));
      localStorage.setItem("customClasses", JSON.stringify(customClasses));
      localStorage.setItem("tasks", JSON.stringify(tasks));
      updateTaskCount();
    }
    
    // Render tasks to the DOM
    function renderTasks() {
      // Clear existing tasks
      taskListEl.innerHTML = "";
      
      // Filter tasks
      let filteredTasks = activeCategory && activeCategory !== "all"
        ? tasks.filter(task => task.categoryId === activeCategory)
        : tasks;
      
      if (searchTerm) {
        filteredTasks = filteredTasks.filter(task => 
          task.title.toLowerCase().includes(searchTerm.toLowerCase())
        );
      }
      
      if (filterCompleted !== null) {
        filteredTasks = filteredTasks.filter(task => task.completed === filterCompleted);
      }
      
      if (filterPriority && filterPriority !== "all") {
        filteredTasks = filteredTasks.filter(task => task.priority === filterPriority);
      }
      
      // Sort tasks
      filteredTasks.sort((a, b) => {
        if (sortField === "order") {
          return sortDirection === "asc" ? a.order - b.order : b.order - a.order;
        }
        
        if (sortField === "title") {
          if (!a.title || !b.title) return 0;
          return sortDirection === "asc" 
            ? a.title.localeCompare(b.title) 
            : b.title.localeCompare(a.title);
        }
        
        if (sortField === "dueDate") {
          if (!a.dueDate && !b.dueDate) return 0;
          if (!a.dueDate) return sortDirection === "asc" ? 1 : -1;
          if (!b.dueDate) return sortDirection === "asc" ? -1 : 1;
          
          const dateA = new Date(a.dueDate).getTime();
          const dateB = new Date(b.dueDate).getTime();
          return sortDirection === "asc" ? dateA - dateB : dateB - dateA;
        }
        
        if (sortField === "priority") {
          const priorityOrder = { high: 3, medium: 2, low: 1, undefined: 0 };
          const priorityA = priorityOrder[a.priority] || 0;
          const priorityB = priorityOrder[b.priority] || 0;
          
          return sortDirection === "asc" ? priorityA - priorityB : priorityB - priorityA;
        }
        
        return 0;
      });

      // Display no tasks message if needed
      if (filteredTasks.length === 0) {
        taskListEl.innerHTML = `
          <div class="text-center py-10 text-muted-foreground">
            <div style="display: flex; justify-content: center; margin-bottom: 8px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 6H3"></path><path d="M10 12H3"></path><path d="M10 18H3"></path><path d="m16 12 2 2 4-4"></path></svg>
            </div>
            <p>No tasks found</p>
          </div>
        `;
        return;
      }
      
      // Create task list with drag and drop capability
      filteredTasks.forEach((task, index) => {
        const category = categories.find(cat => cat.id === task.categoryId);
        const taskClasses = customClasses.filter(cls => task.classIds && task.classIds.includes(cls.id));
        
        const taskEl = document.createElement("div");
        taskEl.className = `task-card ${task.completed ? 'task-completed' : ''} ${task.priority ? 'priority-' + task.priority : ''}`;
        taskEl.setAttribute("data-id", task.id);
        taskEl.setAttribute("draggable", true);
        
        // Check if task is due soon (within next 24 hours) or overdue
        const isTaskDueSoon = () => {
          if (!task.dueDate) return false;
          const dueDate = new Date(task.dueDate);
          const now = new Date();
          const timeDiff = dueDate.getTime() - now.getTime();
          return timeDiff > 0 && timeDiff < 24 * 60 * 60 * 1000;
        };
        
        const isTaskOverdue = () => {
          if (!task.dueDate) return false;
          const dueDate = new Date(task.dueDate);
          return dueDate < new Date();
        };
        
        taskEl.innerHTML = `
          <div class="drag-handle">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
          </div>
          
          <button class="task-toggle button button-ghost button-icon-sm">
            ${task.completed 
              ? '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m5 12 5 5L20 7"></path></svg>' 
              : '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"></rect></svg>'
            }
          </button>

          <div style="flex: 1;">
            <div class="task-title">${task.title}</div>
            <div class="task-meta">
              ${category ? `<span class="category-pill" style="background-color: ${category.color}20; color: ${category.color};">${category.name}</span>` : ''}
              ${taskClasses.map(cls => `<span class="class-badge" style="background-color: ${cls.color}20; color: ${cls.color};">${cls.name}</span>`).join('')}
              
              ${task.priority ? `
                <span style="display: flex; align-items: center; gap: 4px; font-size: 0.75rem;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="${task.priority === 'high' ? '#ef4444' : task.priority === 'medium' ? '#f59e0b' : '#3b82f6'}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path><line x1="4" x2="4" y1="22" y2="15"></line></svg>
                  <span>${task.priority}</span>
                </span>
              ` : ''}
            </div>
            
            ${task.dueDate ? `
              <div style="font-size: 0.75rem; margin-top: 4px; display: flex; align-items: center; gap: 4px;" class="${isTaskOverdue() ? 'overdue' : isTaskDueSoon() ? 'due-soon' : ''}">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                <span>${isTaskOverdue() ? 'Overdue: ' : 'Due: '}${formatDate(task.dueDate)}</span>
              </div>
            ` : ''}
          </div>

          <div class="task-actions">
            <button class="button button-ghost button-icon-sm task-edit-btn">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
            </button>
            <button class="button button-ghost button-icon-sm task-delete-btn">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-destructive"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path></svg>
            </button>
          </div>
        `;
        
        taskListEl.appendChild(taskEl);
        
        // Add event listeners
        const toggleBtn = taskEl.querySelector(".task-toggle");
        toggleBtn.addEventListener("click", () => toggleTaskCompletion(task.id));
        
        const editBtn = taskEl.querySelector(".task-edit-btn");
        editBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          editTask(task);
        });
        
        const deleteBtn = taskEl.querySelector(".task-delete-btn");
        deleteBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          deleteTask(task.id);
        });
        
        // Open task detail on click
        taskEl.addEventListener("click", (e) => {
          if (!e.target.closest('.task-toggle, .task-edit-btn, .task-delete-btn, .drag-handle')) {
            showTaskDetail(task);
          }
        });

        // Drag and drop functionality
        taskEl.addEventListener("dragstart", (e) => {
          e.dataTransfer.setData("text/plain", task.id);
          taskEl.classList.add("dragging");
          setTimeout(() => {
            taskEl.classList.add("opacity-50");
          }, 0);
        });

        taskEl.addEventListener("dragend", () => {
          taskEl.classList.remove("dragging");
          taskEl.classList.remove("opacity-50");
        });
      });

      // Make task list a drop target
      taskListEl.addEventListener("dragover", (e) => {
        e.preventDefault();
        const afterElement = getDragAfterElement(taskListEl, e.clientY);
        const draggable = document.querySelector(".dragging");
        if (draggable) {
          if (afterElement == null) {
            taskListEl.appendChild(draggable);
          } else {
            taskListEl.insertBefore(draggable, afterElement);
          }
        }
      });

      taskListEl.addEventListener("drop", (e) => {
        e.preventDefault();
        const taskId = e.dataTransfer.getData("text/plain");
        const taskElements = Array.from(taskListEl.querySelectorAll(".task-card"));
        
        // Find the new position of the task
        const newIndex = taskElements.findIndex(el => el.getAttribute("data-id") === taskId);
        
        // Update the order of all tasks
        taskElements.forEach((el, index) => {
          const id = el.getAttribute("data-id");
          const taskIndex = tasks.findIndex(t => t.id === id);
          if (taskIndex !== -1) {
            tasks[taskIndex].order = index;
          }
        });
        
        saveData();
      });
    }

    // Helper function for drag and drop to determine where to place element
    function getDragAfterElement(container, y) {
      const draggableElements = [...container.querySelectorAll(".task-card:not(.dragging)")];
      
      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        
        if (offset < 0 && offset > closest.offset) {
          return { offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    // Render categories to the DOM
    function renderCategories() {
      // Clear existing categories (except "All Tasks")
      const allTasksItem = categoryListEl.querySelector('[data-id="all"]');
      categoryListEl.innerHTML = '';
      categoryListEl.appendChild(allTasksItem);
      
      // Add categories to dropdown
      const categorySelectEl = document.getElementById("task-category");
      categorySelectEl.innerHTML = '';
      
      categories.forEach(category => {
        // Add to category list
        const categoryItem = document.createElement("li");
        categoryItem.className = `category-item ${activeCategory === category.id ? 'active' : ''}`;
        categoryItem.setAttribute("data-id", category.id);
        
        categoryItem.innerHTML = `
          <span class="category-color" style="background-color: ${category.color};"></span>
          <span class="category-name">${category.name}</span>
          <span class="category-count">${tasks.filter(task => task.categoryId === category.id).length}</span>
        `;
        
        categoryListEl.appendChild(categoryItem);
        
        // Add to category dropdown
        const option = document.createElement("option");
        option.value = category.id;
        option.textContent = category.name;
        categorySelectEl.appendChild(option);
      });
      
      // Add event listeners
      document.querySelectorAll('.category-item').forEach(item => {
        item.addEventListener("click", () => {
          const categoryId = item.getAttribute("data-id");
          activeCategory = categoryId === "all" ? null : categoryId;
          
          // Update active state
          document.querySelectorAll('.category-item').forEach(el => {
            el.classList.toggle("active", 
              (categoryId === "all" && el.getAttribute("data-id") === "all") || 
              el.getAttribute("data-id") === activeCategory
            );
          });
          
          renderTasks();
        });
      });
    }
    
    // Render classes to the DOM
    function renderClasses() {
      // Clear existing classes
      classListEl.innerHTML = '';
      
      customClasses.forEach(cls => {
        // Add to class list
        const classItem = document.createElement("li");
        classItem.className = "category-item";
        classItem.setAttribute("data-id", cls.id);
        
        classItem.innerHTML = `
          <span class="category-color" style="background-color: ${cls.color};"></span>
          <span class="category-name">${cls.name}</span>
          <span class="category-count">${tasks.filter(task => task.classIds && task.classIds.includes(cls.id)).length}</span>
        `;
        
        classListEl.appendChild(classItem);
      });
      
      // Update task form classes
      updateTaskFormClasses();
    }
    
    // Update the task count for categories and classes
    function updateTaskCount() {
      // Update all tasks count
      const allTasksItem = document.querySelector('.category-item[data-id="all"]');
      if (allTasksItem) {
        const countEl = allTasksItem.querySelector('.category-count');
        countEl.textContent = tasks.length;
      }
      
      // Update category counts
      categories.forEach(category => {
        const categoryItem = document.querySelector(`.category-item[data-id="${category.id}"]`);
        if (categoryItem) {
          const countEl = categoryItem.querySelector('.category-count');
          countEl.textContent = tasks.filter(task => task.categoryId === category.id).length;
        }
      });
      
      // Update class counts
      customClasses.forEach(cls => {
        const classItem = document.querySelector(`.category-item[data-id="${cls.id}"]`);
        if (classItem) {
          const countEl = classItem.querySelector('.category-count');
          countEl.textContent = tasks.filter(task => task.classIds && task.classIds.includes(cls.id)).length;
        }
      });
    }
    
    // Update the task form classes checkboxes
    function updateTaskFormClasses(selectedClassIds = []) {
      const taskClassesEl = document.getElementById("task-classes");
      taskClassesEl.innerHTML = '';
      
      customClasses.forEach(cls => {
        const isChecked = selectedClassIds.includes(cls.id);
        
        const checkboxWrapper = document.createElement("div");
        checkboxWrapper.className = "task-class-option";
        checkboxWrapper.style.marginBottom = "8px";
        checkboxWrapper.innerHTML = `
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" value="${cls.id}" ${isChecked ? 'checked' : ''}>
            <span class="category-color" style="background-color: ${cls.color};"></span>
            <span>${cls.name}</span>
          </label>
        `;
        
        taskClassesEl.appendChild(checkboxWrapper);
      });
    }
    
    // Task operations
    function addTask(taskData) {
      const newTask = {
        id: generateUUID(),
        title: taskData.title,
        categoryId: taskData.categoryId || "default",
        classIds: taskData.classIds || [],
        completed: false,
        createdAt: new Date().toISOString(),
        dueDate: taskData.dueDate ? new Date(taskData.dueDate).toISOString() : null,
        priority: taskData.priority || null,
        order: tasks.length,
      };
      
      tasks.push(newTask);
      saveData();
      renderTasks();
      
      showToast("Task created", `"${newTask.title}" has been added to your tasks`);
    }
    
    function editTask(task) {
      activeTask = task;
      
      // Populate form
      document.getElementById("task-title").value = task.title;
      document.getElementById("task-category").value = task.categoryId || "default";
      document.getElementById("task-due-date").value = task.dueDate ? formatDate(task.dueDate) : "";
      document.getElementById("task-priority").value = task.priority || "";
      
      // Update classes
      updateTaskFormClasses(task.classIds || []);
      
      // Update modal title
      document.querySelector("#task-modal-overlay .modal-title").textContent = "Edit Task";
      
      // Open modal
      openModal(taskModalOverlayEl);
    }
    
    function updateTask(taskData) {
      if (!activeTask) return;
      
      const taskIndex = tasks.findIndex(task => task.id === activeTask.id);
      if (taskIndex === -1) return;
      
      tasks[taskIndex] = {
        ...tasks[taskIndex],
        title: taskData.title,
        categoryId: taskData.categoryId,
        classIds: taskData.classIds,
        dueDate: taskData.dueDate ? new Date(taskData.dueDate).toISOString() : null,
        priority: taskData.priority,
      };
      
      saveData();
      renderTasks();
      
      showToast("Task updated", `"${taskData.title}" has been updated`);
    }
    
    function deleteTask(taskId) {
      const taskToDelete = tasks.find(task => task.id === taskId);
      if (!taskToDelete) return;
      
      tasks = tasks.filter(task => task.id !== taskId);
      saveData();
      renderTasks();
      
      showToast("Task deleted", `"${taskToDelete.title}" has been removed`);
    }
    
    function toggleTaskCompletion(taskId) {
      const taskIndex = tasks.findIndex(task => task.id === taskId);
      if (taskIndex === -1) return;
      
      tasks[taskIndex].completed = !tasks[taskIndex].completed;
      saveData();
      renderTasks();
    }
    
    // Category operations
    function addCategory(categoryData) {
      const newCategory = {
        id: generateUUID(),
        name: categoryData.name,
        color: categoryData.color,
      };
      
      categories.push(newCategory);
      saveData();
      renderCategories();
      
      showToast("Category created", `"${newCategory.name}" category has been created`);
    }
    
    // Class operations
    function addClass(classData) {
      const newClass = {
        id: generateUUID(),
        name: classData.name,
        color: classData.color,
      };
      
      customClasses.push(newClass);
      saveData();
      renderClasses();
      
      showToast("Class created", `"${newClass.name}" class has been created`);
    }

    // Task detail
    function showTaskDetail(task) {
      const taskDetailTitleEl = document.getElementById("task-detail-title");
      const taskDetailEl = document.getElementById("task-detail");
      
      // Set the task as active
      activeTask = task;
      
      // Set the title
      taskDetailTitleEl.textContent = task.title;
      
      // Get task metadata
      const category = categories.find(cat => cat.id === task.categoryId);
      const taskClasses = customClasses.filter(cls => task.classIds && task.classIds.includes(cls.id));
      
      // Build the task detail content
      taskDetailEl.innerHTML = `
        <div class="task-detail-header">
          <div class="task-detail-meta">
            ${category ? `<span class="category-pill" style="background-color: ${category.color}20; color: ${category.color};">${category.name}</span>` : ''}
            ${taskClasses.map(cls => `<span class="class-badge" style="background-color: ${cls.color}20; color: ${cls.color};">${cls.name}</span>`).join('')}
            ${task.priority ? `
              <span style="display: flex; align-items: center; gap: 4px; font-size: 0.75rem;">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="${task.priority === 'high' ? '#ef4444' : task.priority === 'medium' ? '#f59e0b' : '#3b82f6'}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path><line x1="4" x2="4" y1="22" y2="15"></line></svg>
                <span>${task.priority} priority</span>
              </span>
            ` : ''}
          </div>
        </div>

        <div class="task-detail-section">
          <div class="task-detail-section-title">Status</div>
          <div style="display: flex; align-items: center; gap: 8px;">
            ${task.completed 
              ? '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m5 12 5 5L20 7"></path></svg><span>Completed</span>' 
              : '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"></rect></svg><span>Active</span>'
            }
          </div>
        </div>
        
        ${task.dueDate ? `
          <div class="task-detail-section">
            <div class="task-detail-section-title">Due Date</div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect><line x1="16" x2="16" y1="2" y2="6"></line><line x1="8" x2="8" y1="2" y2="6"></line><line x1="3" x2="21" y1="10" y2="10"></line></svg>
              <span>${formatDate(task.dueDate)}</span>
            </div>
          </div>
        ` : ''}
        
        <div class="task-detail-section">
          <div class="task-detail-section-title">Created</div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-1.5"></path><path d="M16 2v4"></path><path d="M8 2v4"></path><path d="M3 10h18"></path></svg>
            <span>${formatDate(task.createdAt)}</span>
          </div>
        </div>
      `;
      
      // Open the modal
      openModal(taskDetailModalOverlayEl);
    }
    
    // Date Picker
    function initDatePicker() {
      const monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
      ];
      const dayNames = ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"];
      
      let currentDate = new Date();
      let selectedDate = null;
      
      // Create calendar
      function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        
        // Get first day of month and number of days
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        // Get days from last month
        const daysInPrevMonth = new Date(year, month, 0).getDate();
        
        // Create calendar header
        calendarEl.innerHTML = `
          <div class="calendar-header">
            <button class="button button-ghost button-icon button-sm prev-month">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg>
            </button>
            <div>${monthNames[month]} ${year}</div>
            <button class="button button-ghost button-icon button-sm next-month">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg>
            </button>
          </div>
          <div class="calendar-grid">
            ${dayNames.map(day => `<div class="calendar-day-header">${day}</div>`).join('')}
          </div>
        `;
        
        // Get calendar grid
        const calendarGrid = calendarEl.querySelector(".calendar-grid");
        
        // Add days from previous month
        for (let i = firstDay - 1; i >= 0; i--) {
          const dayEl = document.createElement("div");
          dayEl.className = "calendar-day other-month";
          dayEl.textContent = daysInPrevMonth - i;
          calendarGrid.appendChild(dayEl);
        }
        
        // Add days in current month
        const today = new Date();
        const isCurrentMonth = today.getMonth() === month && today.getFullYear() === year;
        
        for (let day = 1; day <= daysInMonth; day++) {
          const dayDate = new Date(year, month, day);
          
          const dayEl = document.createElement("div");
          dayEl.className = "calendar-day current-month";
          dayEl.textContent = day;
          
          // Check if this day is today
          if (isCurrentMonth && today.getDate() === day) {
            dayEl.classList.add("today");
          }
          
          // Check if this day is selected
          if (selectedDate && 
              selectedDate.getDate() === day && 
              selectedDate.getMonth() === month && 
              selectedDate.getFullYear() === year) {
            dayEl.classList.add("selected");
          }
          
          // Add click event to select the date
          dayEl.addEventListener("click", () => {
            selectedDate = dayDate;
            dueDateInputEl.value = formatDate(dayDate);
            calendarEl.classList.remove("open");
            renderCalendar(); // Re-render to update selected date
          });
          
          calendarGrid.appendChild(dayEl);
        }
        
        // Add days from next month
        const totalDaysAdded = firstDay + daysInMonth;
        const nextMonthDays = Math.ceil(totalDaysAdded / 7) * 7 - totalDaysAdded;
        
        for (let day = 1; day <= nextMonthDays; day++) {
          const dayEl = document.createElement("div");
          dayEl.className = "calendar-day other-month";
          dayEl.textContent = day;
          calendarGrid.appendChild(dayEl);
        }
        
        // Add event listeners for prev/next month
        calendarEl.querySelector(".prev-month").addEventListener("click", () => {
          currentDate.setMonth(currentDate.getMonth() - 1);
          renderCalendar();
        });
        
        calendarEl.querySelector(".next-month").addEventListener("click", () => {
          currentDate.setMonth(currentDate.getMonth() + 1);
          renderCalendar();
        });
      }
      
      // Initialize date picker
      renderCalendar();
      
      // Show/hide calendar on click
      dueDateInputEl.addEventListener("click", () => {
        calendarEl.classList.toggle("open");
        if (calendarEl.classList.contains("open")) {
          renderCalendar();
        }
      });
      
      // Close calendar when clicking outside
      document.addEventListener("click", (e) => {
        if (!e.target.closest(".datepicker") && calendarEl.classList.contains("open")) {
          calendarEl.classList.remove("open");
        }
      });
    }
    
    // Timer functionality
    function initTimer() {
      function updateTimerDisplay() {
        const minutes = timerMinutes < 10 ? `0${timerMinutes}` : timerMinutes;
        const seconds = timerSeconds < 10 ? `0${timerSeconds}` : timerSeconds;
        timerDisplayEl.textContent = `${minutes}:${seconds}`;
      }
      
      function startTimer() {
        if (!timerRunning) {
          timerRunning = true;
          startTimerBtnEl.textContent = "Pause";
          resetTimerBtnEl.disabled = false;
          
          timerInterval = setInterval(() => {
            if (timerSeconds === 0) {
              if (timerMinutes === 0) {
                // Timer finished
                clearInterval(timerInterval);
                timerRunning = false;
                startTimerBtnEl.textContent = "Start";
                
                // Play sound or show notification
                showToast("Time's up!", "Your focus session has ended");
                
                // Reset timer
                timerMinutes = 25;
                timerSeconds = 0;
                updateTimerDisplay();
                return;
              }
              timerMinutes--;
              timerSeconds = 59;
            } else {
              timerSeconds--;
            }
            
            updateTimerDisplay();
          }, 1000);
        } else {
          // Pause timer
          clearInterval(timerInterval);
          timerRunning = false;
          startTimerBtnEl.textContent = "Resume";
        }
      }
      
      function resetTimer() {
        clearInterval(timerInterval);
        timerRunning = false;
        timerMinutes = 25;
        timerSeconds = 0;
        updateTimerDisplay();
        startTimerBtnEl.textContent = "Start";
        resetTimerBtnEl.disabled = true;
      }
      
      // Initialize timer display
      updateTimerDisplay();
      
      // Add event listeners
      startTimerBtnEl.addEventListener("click", startTimer);
      resetTimerBtnEl.addEventListener("click", resetTimer);
    }
    
    // Initialize the app
    function init() {
      // Load data from localStorage
      loadData();
      
      // Initialize date picker
      initDatePicker();
      
      // Initialize timer
      initTimer();
      
      // Event listeners
      
      // Search
      searchInputEl.addEventListener("input", (e) => {
        searchTerm = e.target.value;
        renderTasks();
      });
      
      // Filter buttons
      filterButtonsEl.addEventListener("click", (e) => {
        const filterBtn = e.target.closest("[data-filter]");
        if (!filterBtn) return;
        
        const filter = filterBtn.getAttribute("data-filter");
        filterCompleted = filter === "all" ? null : filter === "completed";
        
        // Update active state
        document.querySelectorAll("[data-filter]").forEach(btn => {
          if (btn.getAttribute("data-filter") === filter) {
            btn.classList.remove("button-outline");
            btn.classList.add("button-primary");
          } else {
            btn.classList.add("button-outline");
            btn.classList.remove("button-primary");
          }
        });
        
        renderTasks();
      });
      
      // Sort dropdown
      sortDropdownTriggerEl.addEventListener("click", () => {
        sortDropdownEl.classList.toggle("open");
      });
      
      sortDropdownEl.addEventListener("click", (e) => {
        const sortItem = e.target.closest("[data-sort]");
        if (!sortItem) return;
        
        const newSortField = sortItem.getAttribute("data-sort");
        
        if (sortField === newSortField) {
          // Toggle direction if same field
          sortDirection = sortDirection === "asc" ? "desc" : "asc";
        } else {
          sortField = newSortField;
          sortDirection = "asc";
        }
        
        sortDropdownEl.classList.remove("open");
        renderTasks();
      });
      
      // Priority dropdown
      priorityDropdownTriggerEl.addEventListener("click", () => {
        priorityDropdownEl.classList.toggle("open");
      });
      
      priorityDropdownEl.addEventListener("click", (e) => {
        const priorityItem = e.target.closest("[data-priority]");
        if (!priorityItem) return;
        
        filterPriority = priorityItem.getAttribute("data-priority");
        if (filterPriority === "all") filterPriority = null;
        
        priorityDropdownEl.classList.remove("open");
        renderTasks();
      });
      
      // Close dropdowns when clicking outside
      document.addEventListener("click", (e) => {
        if (!e.target.closest(".dropdown")) {
          closeAllDropdowns();
        }
      });
      
      // Add Task
      addTaskBtnEl.addEventListener("click", () => {
        activeTask = null;
        document.getElementById("task-form").reset();
        document.getElementById("task-category").value = "default";
        document.getElementById("task-due-date").value = "";
        document.querySelector("#task-modal-overlay .modal-title").textContent = "New Task";
        updateTaskFormClasses();
        openModal(taskModalOverlayEl);
      });
      
      saveTaskBtnEl.addEventListener("click", () => {
        const title = document.getElementById("task-title").value.trim();
        if (!title) return;
        
        const categoryId = document.getElementById("task-category").value;
        const dueDate = document.getElementById("task-due-date").value;
        const priority = document.getElementById("task-priority").value;
        
        // Get selected classes
        const classCheckboxes = document.querySelectorAll('#task-classes input[type="checkbox"]:checked');
        const classIds = Array.from(classCheckboxes).map(checkbox => checkbox.value);
        
        const taskData = {
          title,
          categoryId,
          classIds,
          dueDate: dueDate || null,
          priority: priority || null,
        };
        
        if (activeTask) {
          updateTask(taskData);
        } else {
          addTask(taskData);
        }
        
        closeModal(taskModalOverlayEl);
      });
      
      cancelTaskBtnEl.addEventListener("click", () => {
        closeModal(taskModalOverlayEl);
      });
      
      // Add Category
      addCategoryBtnEl.addEventListener("click", () => {
        document.getElementById("category-form").reset();
        document.getElementById("category-color").value = "#6941c6";
        openModal(categoryModalOverlayEl);
      });
      
      saveCategoryBtnEl.addEventListener("click", () => {
        const name = document.getElementById("category-name").value.trim();
        if (!name) return;
        
        const color = document.getElementById("category-color").value;
        
        addCategory({ name, color });
        closeModal(categoryModalOverlayEl);
      });
      
      cancelCategoryBtnEl.addEventListener("click", () => {
        closeModal(categoryModalOverlayEl);
      });
      
      // Add Class
      addClassBtnEl.addEventListener("click", () => {
        document.getElementById("class-form").reset();
        document.getElementById("class-color").value = "#f97316";
        openModal(classModalOverlayEl);
      });
      
      saveClassBtnEl.addEventListener("click", () => {
        const name = document.getElementById("class-name").value.trim();
        if (!name) return;
        
        const color = document.getElementById("class-color").value;
        
        addClass({ name, color });
        closeModal(classModalOverlayEl);
      });
      
      cancelClassBtnEl.addEventListener("click", () => {
        closeModal(classModalOverlayEl);
      });
      
      // Task Detail
      closeTaskDetailBtnEl.addEventListener("click", () => {
        closeModal(taskDetailModalOverlayEl);
      });
      
      editTaskBtnEl.addEventListener("click", () => {
        closeModal(taskDetailModalOverlayEl);
        if (activeTask) {
          editTask(activeTask);
        }
      });
      
      // Modal close buttons
      modalCloseBtns.forEach(btn => {
        btn.addEventListener("click", () => {
          closeAllModals();
        });
      });
      
      // Close modals when clicking overlay
      document.querySelectorAll(".modal-overlay").forEach(overlay => {
        overlay.addEventListener("click", (e) => {
          if (e.target === overlay) {
            closeModal(overlay);
          }
        });
      });
      
      // Sidebar toggle
      sidebarToggleEl.addEventListener("click", () => {
        sidebarEl.classList.add("open");
        sidebarOverlayEl.classList.add("open");
      });
      
      sidebarCloseEl.addEventListener("click", () => {
        sidebarEl.classList.remove("open");
        sidebarOverlayEl.classList.remove("open");
      });
      
      sidebarOverlayEl.addEventListener("click", () => {
        sidebarEl.classList.remove("open");
        sidebarOverlayEl.classList.remove("open");
      });
      
      // Check if mobile
      function checkMobile() {
        if (window.innerWidth <= 768) {
          sidebarToggleEl.style.display = "block";
          sidebarEl.classList.remove("open");
        } else {
          sidebarToggleEl.style.display = "none";
          sidebarEl.classList.remove("open");
        }
      }
      
      // Check on load and resize
      checkMobile();
      window.addEventListener("resize", checkMobile);
    }

    // Start the app
    init();
  </script>
</body>
</html>
